cat input.txt | cut -d" "  -f3- | sed -re 's/([0-9]+) green[,;]?/g\1/g' -re 's/([0-9]+) red[,;]?/r\1/g' -re 's/([0-9]+) blue[,;]?/b\1/g' | awk '{maxr=0;maxb=0;maxg=0}{for(i=1;i<=NF;i++) {c=substr($i,1,1); n=substr($i,2,length($i)); if (c == "r" && n+0 > maxr) maxr=n; if (c == "g" && n+0 > maxg) maxg=n; if (c == "b" && n+0 > maxb) maxb=n}} {print maxr*maxg*maxb}' | paste -sd+ - | bc
